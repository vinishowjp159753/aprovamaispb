document.addEventListener('DOMContentLoaded', async () => {
    if (typeof firebase === 'undefined') return;
    const db = firebase.firestore();
    const tableBody = document.querySelector('#studentsTable tbody');

    async function loadStudents() {
        const snapshot = await db.collection('inscricoes').orderBy('criadoEm','desc').get();
        tableBody.innerHTML = '';
        snapshot.forEach(doc => {
            const data = doc.data();
            const tr = document.createElement('tr');
            const statusClass = data.status === 'ativo' ? 'ativo' : 'inativo';
            const valorPago = data.valorPago ? `R$ ${parseFloat(data.valorPago).toFixed(2)}` : 'R$ 0,00';
            tr.innerHTML = `
                <td>${doc.id}</td>
                <td>${data.nomeCompleto}</td>
                <td>${data.turma} - ${data.turno || ''}</td>
                <td><span class="status ${statusClass}">${data.status.charAt(0).toUpperCase()+data.status.slice(1)}</span></td>
                <td>${valorPago}</td>
                <td>${data.observacoes || ''}</td>
                <td>
                    <button class="action-btn edit-btn" onclick="editStudent('${doc.id}')"><i class="fas fa-edit"></i></button>
                    <button class="action-btn payment-btn" onclick="showPaymentModal('${doc.id}','${data.nomeCompleto}')"><i class="fas fa-money-bill"></i></button>
                    <button class="action-btn obs-btn" onclick="showObservationModal('${doc.id}','${data.nomeCompleto}')"><i class="fas fa-comment"></i></button>
                </td>
            `;
            tableBody.appendChild(tr);
        });
    }

    await loadStudents();
});
