<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Professores - AprovaMaisPB</title>
  <link rel="stylesheet" href="./assets/css/style.css" />
</head>
<body>
  <header>
    <nav class="nav">
      <div class="brand">
        <img src="./assets/img/logo_aprovamaispb.png" alt="Logo" />
        <span>AprovaMaisPB</span>
      </div>
      <ul class="menu">
        <li><a href="index.html">Início</a></li>
        <li><a href="matricula.html">Matricule-se</a></li>
        <li><a href="professores.html">Professores</a></li>
        <li><a href="login.html">Dashboard</a></li>
      </ul>
      <button class="hamburger" aria-label="menu" onclick="toggleMenu()">☰</button>
    </nav>
  </header>

  <main class="prof-login">
    <h1>Login do Professor</h1>
    <div class="form-card small">
      <form id="prof-login-form">
        <div class="input-group">
          <label for="prof-user">Usuário</label>
          <input id="prof-user" required />
        </div>
        <div class="input-group">
          <label for="prof-pass">Senha</label>
          <input id="prof-pass" type="password" required />
        </div>
        <div class="actions">
          <button type="submit" class="btn-modern">Entrar</button>
        </div>
        <div id="prof-msg" class="msg"></div>
      </form>
    </div>

    <div id="prof-panel" class="panel" style="display:none">
      <h2>Bem-vindo, Professor</h2>
      <div id="prof-info"></div>
      <div class="actions">
        <button onclick="location.reload()" class="btn-modern outline">Sair</button>
      </div>
    </div>
  </main>

<script type="module">
  // Importar funções do Firebase
  import { 
    autenticarProfessor, 
    buscarTurmasProfessor, 
    buscarInscricoesPorTurma 
  } from "./assets/js/firebase.js";

  // Função para mostrar notificação
  function mostrarNotificacao(mensagem, tipo = "success") {
    // Criar elemento de notificação
    const notification = document.createElement('div');
    notification.className = `notification ${tipo}`;
    notification.innerHTML = `
      <span>${mensagem}</span>
      <button onclick="this.parentElement.remove()">×</button>
    `;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.classList.add('show');
    }, 100);
    
    setTimeout(() => {
      notification.classList.remove('show');
      setTimeout(() => {
        notification.remove();
      }, 300);
    }, 5000);
  }

  // Professores login
  const profForm = document.getElementById('prof-login-form');
  if(profForm){
    profForm.addEventListener('submit', async e => {
      e.preventDefault();
      const u = document.getElementById('prof-user').value;
      const p = document.getElementById('prof-pass').value;
      
      if (!u || !p) {
        document.getElementById('prof-msg').textContent = 'Preencha todos os campos.';
        document.getElementById('prof-msg').style.display = 'block';
        return;
      }
      
      try {
        const ok = await autenticarProfessor(u, p);
        const msg = document.getElementById('prof-msg');
        
        if(ok){
          msg.style.color = 'green';
          msg.textContent = 'Login bem-sucedido.';
          msg.style.display = 'block';
          document.getElementById('prof-login-form').style.display = 'none';
          document.getElementById('prof-panel').style.display = 'block';
          await carregarPainelProfessor(u);
        } else {
          msg.style.color = 'crimson';
          msg.textContent = 'Usuário ou senha inválidos.';
          msg.style.display = 'block';
        }
      } catch (error) {
        console.error("Erro no login do professor:", error);
        document.getElementById('prof-msg').style.color = 'crimson';
        document.getElementById('prof-msg').textContent = 'Erro ao fazer login. Tente novamente.';
        document.getElementById('prof-msg').style.display = 'block';
      }
    });
  }

  async function carregarPainelProfessor(usuario) {
    try {
      // Buscar turmas designadas para este professor
      const turmas = await buscarTurmasProfessor(usuario);
      const panel = document.getElementById('prof-info');
      
      if (turmas.length > 0) {
        let html = '<h3>Suas Turmas</h3><div class="turma-grid">';
        
        for (const turma of turmas) {
          // Buscar alunos para cada turma
          const alunos = await buscarInscricoesPorTurma(turma.turma);
          
          html += `
            <div class="turma-card">
              <h4>${turma.turma}</h4>
              <p>Designada em: ${new Date(turma.designadoEm).toLocaleDateString('pt-BR')}</p>
              <div class="alunos-list">
                <h5>Alunos (${alunos.length})</h5>
                ${alunos.length > 0 ? 
                  alunos.map(aluno => `
                    <div class="aluno-item">
                      <span>${aluno.name}</span>
                      <span class="status-badge ${aluno.status || 'pendente'}">${aluno.status || 'pendente'}</span>
                    </div>
                  `).join('') : 
                  '<p>Nenhum aluno nesta turma ainda.</p>'
                }
              </div>
            </div>
          `;
        }
        
        html += '</div>';
        panel.innerHTML = html;
      } else {
        panel.innerHTML = '<p>Nenhuma turma designada no momento.</p>';
      }
    } catch (error) {
      console.error("Erro ao carregar painel do professor:", error);
      document.getElementById('prof-info').innerHTML = '<p>Erro ao carregar informações. Tente novamente.</p>';
    }
  }

  // Adicionar estilo de notificação se não existir
  if (!document.querySelector('style#notification-styles')) {
    const style = document.createElement('style');
    style.id = 'notification-styles';
    style.textContent = `
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        color: white;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        display: flex;
        align-items: center;
        gap: 10px;
        transform: translateX(100%);
        opacity: 0;
        transition: transform 0.3s, opacity 0.3s;
      }
      .notification.show {
        transform: translateX(0);
        opacity: 1;
      }
      .notification.success {
        background: #28a745;
      }
      .notification.error {
        background: #dc3545;
      }
      .status-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
      }
      .status-badge.pendente {
        background: #ffc107;
        color: #000;
      }
      .status-badge.confirmado {
        background: #28a745;
        color: #fff;
      }
      .status-badge.cancelado {
        background: #dc3545;
        color: #fff;
      }
    `;
    document.head.appendChild(style);
  }
</script>

<script>
function toggleMenu(){
  document.querySelector('.menu').classList.toggle('open');
}
</script>
</body>
</html>
