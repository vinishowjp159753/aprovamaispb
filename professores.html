<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>√Årea do Professor - AprovaMaisPB</title>

  <style>
    /* [TODO O CSS ANTERIOR PERMANECE IGUAL] */
    /* Manter todo o CSS que j√° estava funcionando */
  </style>
</head>
<body>

<!-- [TODO O HTML ANTERIOR PERMANECE IGUAL] -->
<!-- Manter toda a estrutura HTML que j√° estava funcionando -->

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { 
    getFirestore, 
    collection, 
    getDocs, 
    query, 
    where 
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  // SUA CONFIGURA√á√ÉO DO FIREBASE - VERIFIQUE SE EST√Å CORRETA!
  const firebaseConfig = {
    apiKey: "sua-api-key",
    authDomain: "seu-projeto.firebaseapp.com",
    projectId: "seu-projeto-id",
    storageBucket: "seu-projeto.appspot.com",
    messagingSenderId: "seu-sender-id",
    appId: "seu-app-id"
  };

  // Inicializar Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  class ProfessoresAuth {
    async autenticarProfessor(usuario, senha) {
      try {
        console.log('üîê Tentando autenticar professor:', usuario);
        
        // Primeiro, vamos listar TODOS os professores para debug
        const professoresRef = collection(db, "professores");
        const todosProfessores = await getDocs(professoresRef);
        
        console.log('üìä Todos os professores na cole√ß√£o:');
        todosProfessores.forEach((doc) => {
          console.log('ID:', doc.id, 'Dados:', doc.data());
        });

        // Agora busca espec√≠fica pelo usu√°rio
        const q = query(professoresRef, where("usuario", "==", usuario));
        const querySnapshot = await getDocs(q);
        
        console.log('üîç Resultado da busca por usu√°rio:', usuario);
        console.log('N√∫mero de documentos encontrados:', querySnapshot.size);
        
        if (!querySnapshot.empty) {
          const professorDoc = querySnapshot.docs[0];
          const professorData = professorDoc.data();
          
          console.log('‚úÖ Usu√°rio encontrado! Dados:', professorData);
          console.log('üîë Senha fornecida:', senha);
          console.log('üîë Senha no banco:', professorData.senha);
          console.log('üîç Compara√ß√£o:', professorData.senha === senha);
          
          // Verifica√ß√£o detalhada da senha
          if (professorData.senha === senha) {
            console.log('üéâ Autentica√ß√£o bem-sucedida!');
            
            localStorage.setItem('professorLogado', JSON.stringify({
              id: professorDoc.id,
              usuario: professorData.usuario,
              nome: professorData.nome || professorData.usuario,
              email: professorData.email || '',
              materia: professorData.materia || ''
            }));
            
            return true;
          } else {
            console.log('‚ùå Senha incorreta');
            return false;
          }
        } else {
          console.log('‚ùå Nenhum professor encontrado com o usu√°rio:', usuario);
          return false;
        }
      } catch (error) {
        console.error('üí• Erro na autentica√ß√£o:', error);
        console.error('Detalhes do erro:', error.message);
        return false;
      }
    }

    async buscarTurmasProfessor(professorId) {
      try {
        console.log('üè´ Buscando turmas para professor ID:', professorId);
        
        const designacoesRef = collection(db, "designacoes");
        
        // Primeiro, listar todas as designa√ß√µes para debug
        const todasDesignacoes = await getDocs(designacoesRef);
        console.log('üìä Todas as designa√ß√µes:');
        todasDesignacoes.forEach((doc) => {
          console.log('Designa√ß√£o:', doc.id, doc.data());
        });

        const q = query(designacoesRef, where("professorId", "==", professorId));
        const querySnapshot = await getDocs(q);
        
        console.log('üîç Designa√ß√µes encontradas para o professor:', querySnapshot.size);
        
        const turmas = [];
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          console.log('üìã Dados da designa√ß√£o:', data);
          turmas.push({
            id: doc.id,
            turma: data.turma,
            professorId: data.professorId,
            disciplina: data.disciplina || 'N√£o informada',
            periodo: data.periodo || 'N√£o informado'
          });
        });
        
        return turmas;
      } catch (error) {
        console.error('Erro ao buscar turmas:', error);
        return [];
      }
    }

    async buscarAlunosPorTurma(turma) {
      try {
        console.log('üë• Buscando alunos da turma:', turma);
        
        const inscricoesRef = collection(db, "inscricoes");
        
        // Debug: listar todas as inscri√ß√µes
        const todasInscricoes = await getDocs(inscricoesRef);
        console.log('üìä Todas as inscri√ß√µes:');
        todasInscricoes.forEach((doc) => {
          console.log('Inscri√ß√£o:', doc.id, doc.data());
        });

        const q = query(inscricoesRef, where("turma", "==", turma));
        const querySnapshot = await getDocs(q);
        
        console.log('üéì Alunos encontrados na turma:', querySnapshot.size);
        
        const alunos = [];
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          alunos.push({
            id: doc.id,
            nome: data.nome || data.nomeCompleto || 'Nome n√£o informado',
            email: data.email || 'Email n√£o informado',
            telefone: data.telefone || 'Telefone n√£o informado',
            usuario: data.usuario || 'Usu√°rio n√£o informado',
            status: data.status || 'pendente',
            materia: data.materia || 'N√£o informada',
            turma: data.turma || turma,
            criadoEm: data.criadoEm ? this.formatarData(data.criadoEm) : 'Data n√£o informada'
          });
        });
        
        return alunos;
      } catch (error) {
        console.error('Erro ao buscar alunos:', error);
        return [];
      }
    }

    formatarData(data) {
      try {
        if (typeof data === 'string') {
          return new Date(data).toLocaleDateString('pt-BR');
        } else if (data && data.seconds) {
          return new Date(data.seconds * 1000).toLocaleDateString('pt-BR');
        }
        return 'Data n√£o informada';
      } catch (error) {
        return 'Data inv√°lida';
      }
    }

    isProfessorLogado() {
      return localStorage.getItem('professorLogado') !== null;
    }

    getProfessorLogado() {
      const professor = localStorage.getItem('professorLogado');
      return professor ? JSON.parse(professor) : null;
    }

    logout() {
      localStorage.removeItem('professorLogado');
    }
  }

  // Expor para escopo global
  window.professoresAuth = new ProfessoresAuth();
  window.db = db;
</script>

<script>
  // LOGIN COM MAIS DETALHES DE DEBUG
  document.getElementById('login-form').addEventListener('submit', async function(e){
    e.preventDefault();
    const usuario = document.getElementById('usuario').value.trim();
    const senha = document.getElementById('senha').value;
    const errorElement = document.getElementById('login-error');
    const loginBtn = document.getElementById('login-btn');
    
    errorElement.style.display = 'none';
    loginBtn.disabled = true;
    loginBtn.innerHTML = '<span>‚è≥</span><span>Autenticando...</span>';

    console.log('üîÑ Iniciando processo de login...');
    console.log('üìù Usu√°rio digitado:', usuario);
    console.log('üîê Senha digitada:', senha);

    try {
      const logado = await window.professoresAuth.autenticarProfessor(usuario, senha);
      
      if(logado){
        console.log('‚úÖ Login bem-sucedido! Redirecionando...');
        document.getElementById('login-section').classList.add('hidden');
        document.getElementById('professor-panel').classList.remove('hidden');
        
        const professor = window.professoresAuth.getProfessorLogado();
        document.getElementById('professor-name').textContent = professor.nome;
        
        await carregarDadosProfessor(professor.id);
      } else {
        console.log('‚ùå Falha no login');
        errorElement.style.display = 'block';
        errorElement.textContent = '‚ùå Usu√°rio ou senha incorretos!';
      }
    } catch(err){ 
      console.error('üí• Erro no login:', err); 
      errorElement.style.display = 'block';
      errorElement.textContent = '‚ùå Erro de conex√£o. Tente novamente.';
    } finally {
      loginBtn.disabled = false;
      loginBtn.innerHTML = '<span>üöÄ</span><span>Acessar Portal</span>';
    }
  });

  // [O RESTANTE DO C√ìDIGO PERMANECE IGUAL]
  // ... carregarDadosProfessor, contatarAluno, etc.
</script>
</body>
</html>
