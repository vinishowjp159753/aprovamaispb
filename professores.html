<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>√Årea do Professor - AprovaMaisPB</title>

  <style>
    /* [TODO O CSS ANTERIOR PERMANECE IGUAL] */
    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --dark: #1e293b;
      --light: #f8fafc;
      --white: #ffffff;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-600: #4b5563;
      --gray-800: #1f2937;
      --shadow: 0 4px 12px rgba(0,0,0,0.1);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.15);
      --radius: 8px;
      --radius-lg: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
      line-height: 1.5;
      font-size: 14px;
    }

    /* [RESTANTE DO CSS PERMANECE IGUAL] */
    /* ... */
  </style>
</head>
<body>

<header>
  <nav class="nav">
    <div class="brand">
      <img src="./assets/img/logo_aprovamaispb.png" alt="Logo" />
      <span>AprovaMaisPB</span>
    </div>
    <ul class="menu" id="main-menu">
      <li><a href="index.html">In√≠cio</a></li>
      <li><a href="matricula.html">Matricule-se</a></li>
      <li><a href="professores.html" class="active">√Årea do Professor</a></li>
      <li><a href="login.html">Login Admin</a></li>
    </ul>
    <button class="hamburger" onclick="toggleMenu()" aria-label="Menu">
      <span>‚ò∞</span>
    </button>
  </nav>
</header>

<!-- LOGIN SECTION -->
<div id="login-section">
  <main class="login-container">
    <h2>üë®‚Äçüè´ √Årea do Professor</h2>
    <p>Entre com suas credenciais de acesso</p>
    
    <form id="login-form">
      <div class="form-group">
        <label for="usuario">Usu√°rio:</label>
        <input type="text" id="usuario" required placeholder="Digite seu usu√°rio">
      </div>
      
      <div class="form-group">
        <label for="senha">Senha:</label>
        <input type="password" id="senha" required placeholder="Digite sua senha">
      </div>
      
      <div class="error-message" id="login-error">
        ‚ùå Usu√°rio ou senha incorretos!
      </div>
      
      <button type="submit" class="btn-modern" id="login-btn">
        <span>üöÄ</span>
        <span>Acessar Portal</span>
      </button>
    </form>
    
    <div class="mt-2 p-1" style="background: var(--gray-100); border-radius: var(--radius);">
      <h4 class="mb-1">üí° Informa√ß√µes Importantes</h4>
      <p class="text-small">‚Ä¢ Credenciais fornecidas pela administra√ß√£o</p>
      <p class="text-small">‚Ä¢ Em caso de problemas, contate o suporte</p>
      <p class="text-small">‚Ä¢ Acesso restrito aos professores autorizados</p>
    </div>
  </main>
</div>

<!-- PAINEL DO PROFESSOR -->
<div id="professor-panel" class="hidden">
  <div class="welcome-header">
    <div class="container">
      <h1>Bem-vindo, <span id="professor-name">Professor</span>! üëã</h1>
      <p>Gerencie suas turmas designadas</p>
      <button class="btn-modern" onclick="fazerLogout()" style="max-width: 200px; margin: 1rem auto 0;">
        <span>üö™</span>
        <span>Sair do Sistema</span>
      </button>
    </div>
  </div>

  <div class="container">
    <!-- Dashboard Stats -->
    <div class="dashboard-grid">
      <div class="stats-card">
        <div class="stats-number" id="total-alunos">0</div>
        <div class="stats-label">üë• Total de Alunos</div>
      </div>
      
      <div class="stats-card">
        <div class="stats-number" id="total-turmas">0</div>
        <div class="stats-label">üè´ Turmas Designadas</div>
      </div>
      
      <div class="stats-card">
        <div class="stats-number" id="alunos-ativos">0</div>
        <div class="stats-label">‚úÖ Alunos Ativos</div>
      </div>
    </div>

    <!-- Turmas -->
    <h2 class="section-title">üìö Minhas Turmas Designadas</h2>
    <p class="section-subtitle">Turmas sob sua responsabilidade</p>
    
    <div class="turmas-container" id="turmas-list">
      <div class="loading">
        <div class="loading-spinner"></div>
        <p>Carregando suas turmas...</p>
      </div>
    </div>

    <!-- Suporte -->
    <div class="support-section">
      <h3>üìû Precisa de Ajuda?</h3>
      <p>Nossa equipe de suporte est√° sempre dispon√≠vel para ajudar voc√™</p>
      <div class="support-grid">
        <div class="support-item">
          <strong>üì± Telefone:</strong><br>
          (83) 99999-9999
        </div>
        <div class="support-item">
          <strong>‚úâÔ∏è Email:</strong><br>
          suporte@aprovamaispb.com
        </div>
        <div class="support-item">
          <strong>üïí Hor√°rio:</strong><br>
          08:00 - 18:00 (Seg-Sex)
        </div>
      </div>
    </div>
  </div>
</div>

<!-- SIMULA√á√ÉO PARA TESTE (REMOVA QUANDO O FIREBASE ESTIVER FUNCIONANDO) -->
<script>
  // Sistema de simula√ß√£o para teste r√°pido
  class ProfessoresAuthSimulado {
    async autenticarProfessor(usuario, senha) {
      console.log('üîê Tentando login:', usuario, senha);
      
      // Simular delay de rede
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      // Dados de teste
      const professoresTeste = [
        { usuario: "admin", senha: "123456", nome: "Professor Admin", materia: "Matem√°tica" },
        { usuario: "professor", senha: "123456", nome: "Jo√£o Silva", materia: "Portugu√™s" },
        { usuario: "teste", senha: "teste123", nome: "Professor Teste", materia: "Hist√≥ria" }
      ];
      
      const professor = professoresTeste.find(p => p.usuario === usuario && p.senha === senha);
      
      if (professor) {
        console.log('‚úÖ Login bem-sucedido');
        localStorage.setItem('professorLogado', JSON.stringify({
          id: 'simulado-' + Date.now(),
          ...professor
        }));
        return true;
      }
      
      console.log('‚ùå Login falhou');
      return false;
    }

    async buscarTurmasProfessor(professorId) {
      await new Promise(resolve => setTimeout(resolve, 500));
      
      return [
        { 
          id: "1", 
          turma: "Turma A - Manh√£", 
          disciplina: "Matem√°tica", 
          periodo: "2024/1",
          professorId: professorId
        },
        { 
          id: "2", 
          turma: "Turma B - Tarde", 
          disciplina: "Portugu√™s", 
          periodo: "2024/1",
          professorId: professorId
        }
      ];
    }

    async buscarAlunosPorTurma(turma) {
      await new Promise(resolve => setTimeout(resolve, 300));
      
      const alunosBase = [
        {
          nome: "Ana Silva Santos",
          telefone: "83999111111",
          email: "ana.silva@email.com",
          status: "ativo",
          usuario: "ana123",
          turma: turma,
          criadoEm: "24/09/2024"
        },
        {
          nome: "Carlos Oliveira Lima",
          telefone: "83999222222", 
          email: "carlos.lima@email.com",
          status: "ativo",
          usuario: "carlos456",
          turma: turma,
          criadoEm: "23/09/2024"
        },
        {
          nome: "Mariana Costa Pereira",
          telefone: "83999333333",
          email: "mariana.pereira@email.com",
          status: "pendente",
          usuario: "mariana789",
          turma: turma,
          criadoEm: "22/09/2024"
        }
      ];
      
      return turma.includes('A') ? alunosBase : alunosBase.slice(0, 2);
    }

    isProfessorLogado() {
      return localStorage.getItem('professorLogado') !== null;
    }

    getProfessorLogado() {
      const professor = localStorage.getItem('professorLogado');
      return professor ? JSON.parse(professor) : null;
    }

    logout() {
      localStorage.removeItem('professorLogado');
    }
  }

  // Inicializar sistema de simula√ß√£o
  window.professoresAuth = new ProfessoresAuthSimulado();
  console.log('üîß Modo de simula√ß√£o ativado para testes');
</script>

<script>
  // FUN√á√ïES PRINCIPAIS - CORRIGIDAS
  function inicializarLogin() {
    const loginForm = document.getElementById('login-form');
    const errorElement = document.getElementById('login-error');
    
    console.log('üîß Inicializando sistema de login...');
    console.log('üìù Elemento login-form:', loginForm);
    console.log('üìù Elemento login-error:', errorElement);
    
    if (!loginForm) {
      console.error('‚ùå Elemento login-form n√£o encontrado!');
      return;
    }
    
    loginForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const usuario = document.getElementById('usuario').value;
      const senha = document.getElementById('senha').value;
      const loginBtn = document.getElementById('login-btn');
      
      console.log('üîÑ Processando login...');
      
      errorElement.style.display = 'none';
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<span>‚è≥</span><span>Autenticando...</span>';

      try {
        const logado = await window.professoresAuth.autenticarProfessor(usuario, senha);
        
        if(logado){
          console.log('‚úÖ Login bem-sucedido!');
          document.getElementById('login-section').classList.add('hidden');
          document.getElementById('professor-panel').classList.remove('hidden');
          
          const professor = window.professoresAuth.getProfessorLogado();
          document.getElementById('professor-name').textContent = professor.nome;
          
          await carregarDadosProfessor(professor.id);
        } else {
          console.log('‚ùå Login falhou');
          errorElement.style.display = 'block';
          errorElement.textContent = '‚ùå Usu√°rio ou senha incorretos!';
        }
      } catch(err) { 
        console.error('üí• Erro no login:', err); 
        errorElement.style.display = 'block';
        errorElement.textContent = '‚ùå Erro de conex√£o. Tente novamente.';
      } finally {
        loginBtn.disabled = false;
        loginBtn.innerHTML = '<span>üöÄ</span><span>Acessar Portal</span>';
      }
    });
    
    console.log('‚úÖ Sistema de login inicializado com sucesso!');
  }

  async function carregarDadosProfessor(professorId) {
    try {
      console.log('üìä Carregando dados do professor...');
      
      const turmasContainer = document.getElementById('turmas-list');
      turmasContainer.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Carregando suas turmas...</p>
        </div>
      `;

      const turmasDesignadas = await window.professoresAuth.buscarTurmasProfessor(professorId);
      document.getElementById('total-turmas').textContent = turmasDesignadas.length;
      
      let totalAlunos = 0;
      let alunosAtivos = 0;

      if (turmasDesignadas.length === 0) {
        turmasContainer.innerHTML = `
          <div class="text-center" style="padding: 2rem; color: var(--gray-600); grid-column: 1 / -1;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üìö</div>
            <h3 class="mb-1">Nenhuma turma designada</h3>
            <p>Entre em contato com a administra√ß√£o</p>
          </div>
        `;
        return;
      }
      
      turmasContainer.innerHTML = '';

      for(const turma of turmasDesignadas) {
        const alunos = await window.professoresAuth.buscarAlunosPorTurma(turma.turma);
        totalAlunos += alunos.length;
        alunosAtivos += alunos.filter(a => a.status === 'ativo').length;

        const alunosHTML = alunos.length > 0 ? `
          <ul class="aluno-list">
            ${alunos.slice(0, 3).map(aluno => `
              <li class="aluno-item">
                <div class="aluno-info">
                  <div class="aluno-name">${aluno.nome}</div>
                  <div class="aluno-contact">
                    <span>üì± ${aluno.telefone}</span>
                    <span class="status-badge status-${aluno.status}">${aluno.status}</span>
                  </div>
                </div>
                <button class="btn-small" onclick="contatarAluno('${aluno.telefone}')" title="Contatar">
                  üìû
                </button>
              </li>
            `).join('')}
            ${alunos.length > 3 ? `
              <li class="text-center text-small" style="padding: 1rem; color: var(--gray-600);">
                + ${alunos.length - 3} outros alunos
              </li>
            ` : ''}
          </ul>
        ` : `
          <p class="text-center text-small" style="padding: 2rem; color: var(--gray-600);">
            Nenhum aluno matriculado nesta turma
          </p>
        `;

        const turmaHTML = `
          <div class="turma-card">
            <div class="turma-header">
              <div class="turma-title">${turma.turma}</div>
              <div class="turma-badge">${alunos.length} alunos</div>
            </div>
            <div class="turma-info">
              <p><strong>Disciplina:</strong> ${turma.disciplina}</p>
              <p><strong>Per√≠odo:</strong> ${turma.periodo}</p>
            </div>
            <h4 style="font-size: 1rem; margin-bottom: 0.5rem;">üë• Alunos (${alunos.length})</h4>
            ${alunosHTML}
            <div class="btn-group">
              <button class="btn-small" onclick="baixarListaTurma('${turma.turma}')">
                üíæ Baixar CSV
              </button>
              <button class="btn-small" onclick="visualizarTurma('${turma.turma}')">
                üëÅÔ∏è Ver Todos
              </button>
            </div>
          </div>
        `;
        
        turmasContainer.innerHTML += turmaHTML;
      }

      document.getElementById('total-alunos').textContent = totalAlunos;
      document.getElementById('alunos-ativos').textContent = alunosAtivos;
      
      console.log('‚úÖ Dados carregados com sucesso!');
      
    } catch(err) { 
      console.error('üí• Erro ao carregar dados:', err);
      const turmasContainer = document.getElementById('turmas-list');
      turmasContainer.innerHTML = `
        <div class="text-center" style="padding: 2rem; color: var(--danger); grid-column: 1 / -1;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">‚ùå</div>
          <h3 class="mb-1">Erro ao carregar dados</h3>
          <button class="btn-small" onclick="carregarDadosProfessor('${professorId}')" style="margin: 0 auto;">
            üîÑ Tentar Novamente
          </button>
        </div>
      `;
    }
  }

  function contatarAluno(telefone) { 
    if (telefone && telefone !== 'Telefone n√£o informado') {
      const numeroLimpo = telefone.replace(/\D/g, '');
      window.open(`https://wa.me/55${numeroLimpo}`, '_blank');
    } else {
      alert('Telefone n√£o dispon√≠vel para contato');
    }
  }

  async function baixarListaTurma(turma) {
    try {
      const alunos = await window.professoresAuth.buscarAlunosPorTurma(turma);
      if(alunos.length === 0) { 
        alert('Nenhum aluno encontrado nesta turma');
        return; 
      }

      let csv = 'Nome,Email,Telefone,Usu√°rio,Status,Turma,Data Inscri√ß√£o\n';
      alunos.forEach(aluno => { 
        csv += `"${aluno.nome}","${aluno.email}","${aluno.telefone}","${aluno.usuario}","${aluno.status}","${aluno.turma}","${aluno.criadoEm}"\n`; 
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Turma_${turma.replace(/[^a-zA-Z0-9]/g, '_')}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      alert('‚úÖ Lista baixada com sucesso!');
    } catch (error) {
      console.error('Erro ao baixar lista:', error);
      alert('‚ùå Erro ao baixar lista de alunos');
    }
  }

  function visualizarTurma(turma) {
    alert(`Visualizando turma: ${turma}\n\nEm uma vers√£o futura, esta fun√ß√£o mostrar√° todos os alunos em uma modal.`);
  }

  function fazerLogout() {
    window.professoresAuth.logout();
    window.location.reload();
  }

  function toggleMenu() { 
    const menu = document.getElementById('main-menu');
    if (menu) {
      menu.classList.toggle('show');
    }
  }

  // INICIALIZA√á√ÉO DA P√ÅGINA - CORRIGIDA
  document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ P√°gina carregada, inicializando...');
    
    // Inicializar sistema de login
    inicializarLogin();
    
    // Esconder mensagem de erro inicialmente
    const errorElement = document.getElementById('login-error');
    if (errorElement) {
      errorElement.style.display = 'none';
    }
    
    // Verificar se j√° est√° logado
    if (window.professoresAuth && window.professoresAuth.isProfessorLogado()) {
      const professor = window.professoresAuth.getProfessorLogado();
      console.log('üë§ Professor j√° logado:', professor.nome);
      
      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('professor-panel').classList.remove('hidden');
      document.getElementById('professor-name').textContent = professor.nome;
      
      carregarDadosProfessor(professor.id);
    } else {
      console.log('üîí Nenhum professor logado');
    }
    
    console.log('‚úÖ P√°gina inicializada com sucesso!');
  });

  // Exportar fun√ß√µes para uso global
  window.contatarAluno = contatarAluno;
  window.baixarListaTurma = baixarListaTurma;
  window.visualizarTurma = visualizarTurma;
  window.fazerLogout = fazerLogout;
  window.toggleMenu = toggleMenu;
  window.carregarDadosProfessor = carregarDadosProfessor;
</script>

</body>
</html>
