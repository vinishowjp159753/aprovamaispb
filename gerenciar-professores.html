<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Professores - AprovaMaisPB</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="module" src="./assets/js/firebase-config.js"></script>
    <style>
        /* Design antigo mantido */
        :root { --primary: #1a2a6c; --secondary: #b21f1f; --accent: #fdbb2d; }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color:#f5f7fb; color:#333; }
        .container { max-width:1200px; margin:0 auto; padding:20px; }
        .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; }
        .back-btn { display:inline-flex; align-items:center; padding:10px 15px; background:var(--primary); color:white; text-decoration:none; border-radius:5px; font-weight:500; }
        .back-btn i { margin-right:8px; }
        h1 { color:var(--primary); text-align:center; margin:20px 0; }
        .table-container { overflow-x:auto; background:white; padding:15px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.05);}
        table { width:100%; border-collapse:collapse; }
        th, td { padding:12px; text-align:left; border-bottom:1px solid #eee; }
        th { background:var(--primary); color:white; font-weight:500; }
        tr:hover { background:#f9f9f9; }
        .btn { padding:6px 12px; background:var(--primary); color:white; border:none; border-radius:5px; cursor:pointer; font-weight:500; }
        .btn i { margin-right:5px; }
        .assign-btn { background:var(--accent); color:#000; }
        .delete-btn { background:var(--secondary); color:white; }
        .status { padding:5px 10px; border-radius:20px; font-size:12px; font-weight:500; }
        .status.ativo { background:#e8f5e9; color:#2e7d32; }
        .status.inativo { background:#ffebee; color:#d32f2f; }
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; }
        .modal-content { background:white; padding:30px; border-radius:10px; width:500px; max-width:90%; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <a href="dashboard.html" class="back-btn"><i class="fas fa-arrow-left"></i> Voltar ao Dashboard</a>
        <h1>Gerenciar Professores</h1>
        <div></div>
    </div>

    <div class="table-container">
        <table id="teachersTable">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Matéria</th>
                    <th>Usuário</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!-- Modal Editar Professor -->
<div class="modal" id="editModal">
    <div class="modal-content">
        <h2>Editar Professor</h2>
        <div class="form-group">
            <label for="editName">Nome Completo</label>
            <input type="text" id="editName">
        </div>
        <div class="form-group">
            <label for="editEmail">E-mail</label>
            <input type="email" id="editEmail">
        </div>
        <div class="form-group">
            <label for="editMateria">Matéria</label>
            <select id="editMateria">
                <option value="portugues">Português</option>
                <option value="matematica">Matemática</option>
                <option value="historia">História</option>
                <option value="geografia">Geografia</option>
                <option value="ingles">Inglês</option>
            </select>
        </div>
        <div class="form-group">
            <label for="editStatus">Status</label>
            <select id="editStatus">
                <option value="ativo">Ativo</option>
                <option value="inativo">Inativo</option>
            </select>
        </div>
        <div class="form-actions">
            <button class="btn" onclick="closeModal()">Cancelar</button>
            <button class="btn" style="background: var(--primary);" onclick="salvarEdicao()">Salvar</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from './assets/js/firebase-config.js';
    import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const app = initializeApp();
    const db = getFirestore(app);
    let professores = [];
    let professorEditando = null;

    async function carregarProfessores() {
        const querySnapshot = await getDocs(collection(db, "professores"));
        professores = [];
        querySnapshot.forEach((docSnap) => {
            professores.push({ id: docSnap.id, ...docSnap.data() });
        });
        preencherTabela();
    }

    function preencherTabela() {
        const tbody = document.querySelector("#teachersTable tbody");
        tbody.innerHTML = "";
        professores.forEach(prof => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${prof.nome}</td>
                <td>${prof.materia}</td>
                <td>${prof.usuario}</td>
                <td><span class="status ${prof.status}">${prof.status}</span></td>
                <td>
                    <button class="btn" onclick="editarProfessor('${prof.id}')"><i class="fas fa-edit"></i> Editar</button>
                    <button class="btn delete-btn" onclick="excluirProfessor('${prof.id}')"><i class="fas fa-trash"></i> Excluir</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    async function editarProfessor(id) {
        const prof = professores.find(p => p.id === id);
        if (!prof) return;
        professorEditando = prof;
        document.getElementById("editName").value = prof.nome;
        document.getElementById("editEmail").value = prof.email;
        document.getElementById("editMateria").value = prof.materia;
        document.getElementById("editStatus").value = prof.status;
        document.getElementById("editModal").style.display = "flex";
    }

    async function salvarEdicao() {
        if (!professorEditando) return;
        const profRef = doc(db, "professores", professorEditando.id);
        await updateDoc(profRef, {
            nome: document.getElementById("editName").value,
            email: document.getElementById("editEmail").value,
            materia: document.getElementById("editMateria").value,
            status: document.getElementById("editStatus").value
        });
        closeModal();
        await carregarProfessores();
        alert("Professor atualizado com sucesso!");
    }

    async function excluirProfessor(id) {
        if (!confirm("Deseja realmente excluir este professor?")) return;
        await deleteDoc(doc(db, "professores", id));
        await carregarProfessores();
        alert("Professor excluído com sucesso!");
    }

    function closeModal() { document.getElementById("editModal").style.display = "none"; }

    window.addEventListener("DOMContentLoaded", carregarProfessores);
    window.onclick = (event) => { if(event.target.classList.contains('modal')) closeModal(); }
</script>
</body>
</html>
