<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Painel Admin - AprovaMaisPB</title>
  <link rel="stylesheet" href="./assets/css/style.css" />
  <link rel="icon" type="image/png" href="./assets/img/logo_aprovamaispb.png" />
  <style>
    /* ... (mantenha todo o CSS igual) ... */
  </style>
</head>
<body>
  <header>
    <nav class="nav">
      <div class="brand">
        <img src="./assets/img/logo_aprovamaispb.png" alt="Logo" />
        <span>AprovaMaisPB - Admin</span>
      </div>
      <ul class="menu">
        <li><a href="index.html">Início</a></li>
        <li><a href="matricula.html">Matricule-se</a></li>
        <li><a href="professores.html">Professores</a></li>
        <li><a href="admin.html" class="active">Painel Admin</a></li>
        <li><a href="login.html">Sair</a></li>
      </ul>
      <button class="hamburger" aria-label="menu" onclick="toggleMenu()">☰</button>
    </nav>
  </header>

  <main class="container" style="max-width: 1400px; margin: 0 auto; padding: 20px;">
    <h1>Painel Administrativo</h1>

    <div class="admin-grid">
      <div class="admin-sidebar">
        <ul class="admin-menu">
          <li><a href="#alunos" class="active" onclick="showTab('alunos')">Gestão de Alunos</a></li>
          <li><a href="#professores" onclick="showTab('professores')">Gestão de Professores</a></li>
          <li><a href="#turmas" onclick="showTab('turmas')">Designação de Turmas</a></li>
          <li><a href="#financeiro" onclick="showTab('financeiro')">Gestão Financeira</a></li>
          <li><a href="#relatorios" onclick="showTab('relatorios')">Relatórios</a></li>
        </ul>
      </div>

      <div class="admin-content">
        <!-- ... (mantenha o conteúdo das abas igual) ... -->
      </div>
    </div>
  </main>

  <!-- ... (mantenha os modais iguais) ... -->

  <script type="module">
    // Mude para script normal para ter escopo global
    // import { ... } from "./assets/js/firebase.js";
  </script>

  <script>
    // VARIÁVEIS GLOBAIS
    let alunosData = [];
    let professoresData = [];
    let turmasData = [];

    // FUNÇÕES GLOBAIS
    function showTab(tabName) {
      console.log('Mostrando aba:', tabName);
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.admin-menu a').forEach(link => link.classList.remove('active'));
      
      document.getElementById(`tab-${tabName}`).classList.add('active');
      document.querySelector(`.admin-menu a[href="#${tabName}"]`).classList.add('active');
    }

    function abrirModalProfessor() {
      document.getElementById('modal-professor').style.display = 'block';
    }

    function abrirModalDesignacao() {
      document.getElementById('modal-designacao').style.display = 'block';
    }

    function fecharModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    function toggleMenu(){
      document.querySelector('.menu').classList.toggle('open');
    }

    function gerarLoginProfessor(usuario, senha) {
      document.getElementById('login-usuario').value = usuario;
      document.getElementById('login-senha').value = senha;
      document.getElementById('login-link').value = window.location.origin + '/login.html';
      document.getElementById('modal-login').style.display = 'block';
    }

    function designarTurmaAluno(alunoId) {
      abrirModalDesignacao();
      document.getElementById('select-aluno').value = alunoId;
    }

    function copiarCredenciais() {
      const texto = `Usuário: ${document.getElementById('login-usuario').value}\nSenha: ${document.getElementById('login-senha').value}\nAcesso: ${document.getElementById('login-link').value}`;
      navigator.clipboard.writeText(texto);
      alert('Credenciais copiadas para a área de transferência!');
    }

    function gerarRelatorio(tipo) {
      alert(`Relatório de ${tipo} gerado com sucesso!`);
    }

    // Carregar dados quando a página estiver pronta
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Página admin carregada');
      // carregarDadosAdmin(); // Você vai implementar essa função
    });

    // Fechar modal clicando fora
    window.onclick = function(event) {
      if (event.target.className === 'modal') {
        event.target.style.display = 'none';
      }
    }
  </script>

  <!-- Script do Firebase como módulo separado -->
  <script type="module">
    import { 
      listarInscricoes, 
      listarProfessores, 
      buscarTurmasProfessor,
      salvarProfessor,
      designarTurma,
      atualizarInscricao,
      autenticarProfessor
    } from "./assets/js/firebase.js";

    // Atribuir às variáveis globais
    window.salvarProfessorFirebase = salvarProfessor;
    window.designarTurmaFirebase = designarTurma;
    window.atualizarInscricaoFirebase = atualizarInscricao;

    async function carregarDadosAdmin() {
      try {
        console.log('Carregando dados do Firebase...');
        
        // Carregar alunos
        window.alunosData = await listarInscricoes();
        console.log('Alunos carregados:', window.alunosData.length);
        
        // Carregar professores
        window.professoresData = await listarProfessores();
        console.log('Professores carregados:', window.professoresData.length);
        
        // Aqui você pode chamar funções para atualizar as tabelas
        // atualizarTabelaAlunos();
        // atualizarTabelaProfessores();
        
      } catch (error) {
        console.error('Erro ao carregar dados admin:', error);
      }
    }

    // Deixar função global
    window.carregarDadosAdmin = carregarDadosAdmin;

    // Função para salvar professor (agora global)
    window.salvarProfessor = async function() {
      const professor = {
        nome: document.getElementById('professor-nome').value,
        email: document.getElementById('professor-email').value,
        usuario: document.getElementById('professor-usuario').value,
        senha: document.getElementById('professor-senha').value,
        disciplina: document.getElementById('professor-disciplina').value,
        status: 'ativo'
      };

      try {
        await salvarProfessor(professor);
        alert('Professor cadastrado com sucesso!');
        fecharModal('modal-professor');
        carregarDadosAdmin();
      } catch (error) {
        alert('Erro ao cadastrar professor: ' + error.message);
      }
    }

    // Função para salvar designação (agora global)
    window.salvarDesignacao = async function() {
      const alunoId = document.getElementById('select-aluno').value;
      const turma = document.getElementById('select-turma').value;
      const professor = document.getElementById('select-professor').value;

      if (!alunoId || !turma || !professor) {
        alert('Preencha todos os campos!');
        return;
      }

      try {
        await designarTurma(professor, turma);
        await atualizarInscricao(alunoId, { 
          turma: turma,
          status: 'ativo',
          professor: professor
        });
        
        alert('Turma designada com sucesso!');
        fecharModal('modal-designacao');
        carregarDadosAdmin();
      } catch (error) {
        alert('Erro ao designar turma: ' + error.message);
      }
    }

    // Carregar dados quando o módulo for importado
    document.addEventListener('DOMContentLoaded', function() {
      carregarDadosAdmin();
    });
  </script>
</body>
</html>
