<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout - AprovaMaisPB</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root { --primary:#1a2a6c; --secondary:#b21f1f; --accent:#fdbb2d; }
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
body{background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;}
.container{width:100%;max-width:600px;background:rgba(255,255,255,0.95);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.3);overflow:hidden;padding:30px;}
.header{text-align:center;margin-bottom:20px;}
.header img{max-width:120px;margin-bottom:15px;}
.header h1{font-size:24px;color:#1a2a6c;}
.amount{font-size:22px;font-weight:600;color:#333;margin-bottom:20px;text-align:center;}
.btn{padding:14px 25px;background:var(--primary);color:white;border:none;border-radius:6px;cursor:pointer;font-size:16px;font-weight:600;width:100%;transition:background 0.3s;text-align:center;margin-bottom:15px;}
.btn:hover{background:#2a3a9c;}
.alert{padding:15px;border-radius:6px;margin-bottom:20px;display:none;}
.alert.success{background:#e8f5e9;color:#2e7d32;border:1px solid #c8e6c9;}
.alert.error{background:#ffebee;color:#d32f2f;border:1px solid #ffcdd2;}
.loading{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s linear infinite;margin-right:10px;}
@keyframes spin{to{transform:rotate(360deg);}}
.back-btn{display:inline-flex;align-items:center;padding:10px 15px;background:var(--primary);color:white;text-decoration:none;border-radius:5px;font-weight:500;margin-bottom:20px;}
.back-btn i{margin-right:8px;}
</style>
</head>
<body>
<div class="container">
    <a href="matricula.html" class="back-btn"><i class="fas fa-arrow-left"></i> Voltar para Matrícula</a>
    <div class="header">
        <img src="assets/img/logo_aprovamaispb.png" alt="Logo AprovaMaisPB" onerror="this.style.display='none'">
        <h1>Checkout - AprovaMaisPB</h1>
    </div>
    <div class="amount">Valor da Matrícula: <strong>R$150,00</strong></div>

    <div class="alert success" id="successAlert">Pagamento aprovado! Matrícula confirmada.</div>
    <div class="alert error" id="errorAlert">Ocorreu um erro no pagamento. Tente novamente.</div>

    <button class="btn" id="cartaoBtn">Pagar com Cartão</button>
    <button class="btn" id="pixBtn" style="background-color:#25D366;">Pagar com Pix</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAK3U35fipoWOOIJg0yrtgmVfQ7XQxZxqY",
    authDomain: "aprovamaispb-d4e75.firebaseapp.com",
    projectId: "aprovamaispb-d4e75",
    storageBucket: "aprovamaispb-d4e75.firebasestorage.app",
    messagingSenderId: "828577018900",
    appId: "1:828577018900:web:473d8c3fc2685d3f192301"
};
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const urlParams = new URLSearchParams(window.location.search);
const matriculaId = urlParams.get('matriculaId');
const valor = urlParams.get('valor') || 150;

const successAlert = document.getElementById('successAlert');
const errorAlert = document.getElementById('errorAlert');

const cartaoBtn = document.getElementById('cartaoBtn');
const pixBtn = document.getElementById('pixBtn');

// Função simulada de pagamento PagSeguro
async function processarPagamento(metodo){
    try{
        // Aqui você chamaria sua API do PagSeguro com o token fornecido
        // Exemplo: fetch('/pagseguro', {method:'POST', body:{token, valor, metodo}})
        // Para teste, simulamos aprovação automática:
        await new Promise(r=>setTimeout(r,1500));

        // Atualiza valorPago no Firestore
        await db.collection('inscricoes').doc(matriculaId).update({valorPago: parseFloat(valor)});
        successAlert.style.display='block';
        errorAlert.style.display='none';
    }catch(err){
        console.error(err);
        errorAlert.style.display='block';
        successAlert.style.display='none';
    }
}

cartaoBtn.addEventListener('click',()=>processarPagamento('cartao'));
pixBtn.addEventListener('click',()=>processarPagamento('pix'));
</script>
</body>
</html>
